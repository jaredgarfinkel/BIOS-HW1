---
title: "BIOS_HW#1"
author: "Jared Garfinkel"
date: "9/13/2019"
tables: yes
output: html_document
---

#Problem 1

This is the solution for Problem 1

```{r load libraries}
library(tidyverse)
library(arsenal)
library(dplyr)
library(knitr)
```

##Section a

This is a solution for section a.

There is a top row of text that can be ignored for the purposes of creating a table.

```{r import doc}

exercise <- read.csv("C:\\Users\\jared\\OneDrive\\Fall 2019\\Biostatistics\\HW1\\BIOS-HW1\\Exercise.csv", skip = 1)

```

Change the labels.

```{r labels}

my_labels <- list(Age = "Age (yrs)", Gender = "Gender", Race = "Race", HTN = "Hypertensive", T2DM = "Type 2 Diabetes", Depression = "Depression", Smokes = "Smoker")
```

Clean the output.

```{r clean output}
my_controls <- tableby.control(
               total = FALSE,
               test = FALSE,  # No test p-values yet
               numeric.stats = c("meansd", "medianq1q3"),
               cat.stats = c("countpct"),
               stats.labels = list(
               meansd = "Mean (SD)",
               medianq1q3 = "Median (Q1, Q3)",
               countpct = "N (%)"))
```

I found a function called mutate from recitation that is useful for showing categories. No idea why it works.

```{r categories}

table1 <- exercise %>%
  mutate(Group = factor(Group, labels = c("Intervention","Control"))) %>%
  mutate(Gender = factor(Gender, labels = c("Male", "Female"))) %>%
  mutate(Race = factor(Race, labels = c("African American", "Hispanic", "Caucasian"))) %>%
  mutate(HTN = factor(HTN, labels = c("Yes","No"))) %>%
  mutate(T2DM = factor(T2DM, labels = c("Yes", "No"))) %>%
  mutate(Depression = factor(Depression, labels = c("Yes","No"))) %>%
  mutate(Smokes = factor(Smokes,labels = c("Yes","No")))
```

This is a first table.

```{r solution 1a}
solution1a <- tableby(Group ~ Age + Gender + Race + HTN + T2DM + Depression + Smokes, 
                      data = table1, control = my_controls)
```

This is a solution.

```{r output 1a}
summary(solution1a, title = "Demographics and Co-Morbidities", labelTranslations = my_labels,text = TRUE)

```

## Section 1b

This is a solution for Section 1b.

Start with the labels.

```{r labels2, echo = FALSE}

my_labels2 <- list(PRE = "Systolic Blood Pressure (mm Hg)", POST = " ",
                   PRE.1 = "Diastolic Blood Pressure (mm Hg)", POST.1 = " ",
                   PRE.2 = "Body Mass Index", POST.2 = " ",
                   PRE.3 = "HDL Cholesterol", POST.3 = " ",
                   PRE.4 = "LDL Cholesterol", POST.4 = " ",
                   PRE.5 = "Blood Glucose (mmol/L)", POST.5 = " ")
```


```{r categories2, echo = FALSE}
table2 <- exercise %>%
  mutate(Group = factor(Group, labels = c("Control", "Intervention")))
```

Clean the output.

```{r controls2, echo = FALSE}
my_controls2 <- tableby.control(
               total = FALSE,
               test = FALSE,  # No test p-values yet
               numeric.stats = c("meansd", "medianq1q3"),
               cat.stats = c("countpct"),
               stats.labels = list(
               meansd = "Mean (SD)",
               medianq1q3 = "Median (Q1, Q3)",
               countpct = "N (%)"))
```

Use only the variables we are looking at.

```{r table2, echo = FALSE}
solution1b <- tableby(Group ~ PRE + POST + PRE.1 + POST.1 + 
                        PRE.2 + POST.2 + PRE.3 + POST.3 + 
                        PRE.4 + POST.4 + PRE.5 + POST.5,
                      data = table2, control = my_controls2)
```

Make a table.

```{r solution2a, echo = FALSE}
summary(solution1b, title="Metabolic Parameters", labelTranslations = my_labels2, text=TRUE)
```

Create a dataframe that splits data by factor.

```{r split data by factor, echo = FALSE, eval = FALSE}

# exp <- factor(table2$Group)

df_good <- exercise %>% group_by(Group)

df_good %>% summarize(
  pre = mean(PRE),
  post = mean(POST),
  pre.1 = mean(PRE.1),
  post.1 = mean(POST.1),
  pre.2 = mean(PRE.2),
  post.2 = mean(POST.2),
  pre.3 = mean(PRE.3),
  post.3 = mean(POST.3),
  pre.4 = mean(PRE.4),
  post.4 = mean(POST.4),
  pre.5 = mean(PRE.5),
  post.5 = mean(POST.5),
)
```

```{r df, echo = FALSE, eval = FALSE}
mp_df <- df_good %>% tibble(
  Sys_u = mean(PRE), 
  Sys_sd = sd(PRE),
  Sys_u2 = mean(POST), 
  Sys_sd2 = sd(POST)
)
```

```{r df1, echo = FALSE, eval = FALSE}
groupsys1 <- tableby(Group ~ PRE, data=table2, control = my_controls2)
groupsys2 <- tableby(Group ~ POST, data=table2, control = my_controls2)
groupdia1 <- tableby(Group ~ PRE.1, data=table2, control = my_controls2)
groupdia2 <- tableby(Group ~ POST, data=table2, control = my_controls2)
groupbmi1 <- tableby(Group ~ PRE, data=table2, control = my_controls2)
groupbmi2 <- tableby(Group ~ POST, data=table2, control = my_controls2)
grouphdl1 <- tableby(Group ~ PRE, data=table2, control = my_controls2)
grouphdl2 <- tableby(Group ~ POST, data=table2, control = my_controls2)
groupldl1 <- tableby(Group ~ PRE, data=table2, control = my_controls2)
groupldl2 <- tableby(Group ~ POST, data=table2, control = my_controls2)
groupglu1 <- tableby(Group ~ PRE, data=table2, control = my_controls2)
groupglu2 <- tableby(Group ~ POST, data=table2, control = my_controls2)
```

```{r df2, echo = FALSE, eval = FALSE}
table1 <- summary(groupsys1, title="Systolic Blood Pressure", labelTranslations = my_labels2, text=TRUE)
table2 <- summary(groupsys2, title="Systolic Blood Pressure 6-months", labelTranslations = my_labels2, text=TRUE)
kable(list(table1, table2))
```

```{r Pipes, echo = FALSE}
new_df <- select(exercise,Group,PRE,POST,PRE.1,POST.1,PRE.2,POST.2,PRE.3,POST.3,PRE.4,POST.4,PRE.5,POST.5)
new_df1 <- filter(new_df, Group == 1)
new_df2 <- filter(new_df, Group == 0)
```

: Changes in Metabolic Paramaters

------ | Intervention |         | Control |     |    
------ | -------- | ------- | ------- | ------ |
------ | Baseline | 6-months | Baseline | 6-months
Systolic Blood Pressure (mm Hg) | `r round(mean(pull(new_df1,PRE)), digits = 2)` +/- `r round(sd(pull(new_df1,PRE)), digits = 2)` | `r round(mean(pull(new_df1,POST)), digits = 2)` +/- `r round(sd(pull(new_df1,POST)), digits = 2)` | `r round(mean(pull(new_df2,PRE)), digits = 2)` +/- `r round(sd(pull(new_df2,PRE)), digits = 2)` | `r round(mean(pull(new_df2,POST)), digits = 2)` +/- `r round(sd(pull(new_df2,POST)), digits = 2)`
------ | `r round(median(pull(new_df1,PRE)), digits = 2)` (`r q1q3(pull(new_df1,PRE))`) | `r round(median(pull(new_df1,POST)), digits=2)` (`r q1q3(pull(new_df1,POST))`) | `r round(median(pull(new_df2,PRE)), digits = 2)` (`r q1q3(pull(new_df2,PRE))`) | `r round(median(pull(new_df2,POST)), digits=2)` (`r q1q3(pull(new_df2,POST))`)
Diastolic Blood Pressure (mm Hg) | `r round(mean(pull(new_df1,PRE.1)), digits = 2)` +/- `r round(sd(pull(new_df1,PRE.1)), digits = 2)` | `r round(mean(pull(new_df1,POST.1)), digits = 2)` +/- `r round(sd(pull(new_df1,POST.1)), digits = 2)` | `r round(mean(pull(new_df2,PRE.1)), digits = 2)` +/- `r round(sd(pull(new_df2,PRE.1)), digits = 2)` | `r round(mean(pull(new_df2,POST.1)), digits = 2)` +/- `r round(sd(pull(new_df2,POST.1)), digits = 2)`
------ | `r round(median(pull(new_df1,PRE.1)), digits = 2)` (`r q1q3(pull(new_df1,PRE.1))`) | `r round(median(pull(new_df1,POST.1)), digits=2)` (`r q1q3(pull(new_df1,POST.1))`) | `r round(median(pull(new_df2,PRE.1)), digits = 2)` (`r q1q3(pull(new_df2,PRE.1))`) | `r round(median(pull(new_df2,POST.1)), digits=2)` (`r q1q3(pull(new_df2,POST.1))`)
Body Mass Index | `r round(mean(pull(new_df1,PRE.2)), digits = 2)` +/- `r round(sd(pull(new_df1,PRE.2)), digits = 2)` | `r round(mean(pull(new_df1,POST.2)), digits = 2)` +/- `r round(sd(pull(new_df1,POST.2)), digits = 2)` | `r round(mean(pull(new_df2,PRE.2)), digits = 2)` +/- `r round(sd(pull(new_df2,PRE.2)), digits = 2)` | `r round(mean(pull(new_df2,POST.2)), digits = 2)` +/- `r round(sd(pull(new_df2,POST.2)), digits = 2)`
------ | `r round(median(pull(new_df1,PRE.2)), digits = 2)` (`r q1q3(pull(new_df1,PRE.2))`) | `r round(median(pull(new_df1,POST.2)), digits=2)` (`r q1q3(pull(new_df1,POST.2))`) | `r round(median(pull(new_df2,PRE.2)), digits = 2)` (`r q1q3(pull(new_df2,PRE.2))`) | `r round(median(pull(new_df2,POST.2)), digits=2)` (`r q1q3(pull(new_df2,POST.2))`)
HDL Cholesterol (mg/dL) | `r round(mean(pull(new_df1,PRE.3)), digits = 2)` +/- `r round(sd(pull(new_df1,PRE.3)), digits = 2)` | `r round(mean(pull(new_df1,POST.3)), digits = 2)` +/- `r round(sd(pull(new_df1,POST.3)), digits = 2)` | `r round(mean(pull(new_df2,PRE.3)), digits = 2)` +/- `r round(sd(pull(new_df2,PRE.3)), digits = 2)` | `r round(mean(pull(new_df2,POST.3)), digits = 2)` +/- `r round(sd(pull(new_df2,POST.3)), digits = 2)`
------ | `r round(median(pull(new_df1,PRE.3)), digits = 2)` (`r q1q3(pull(new_df1,PRE.3))`) | `r round(median(pull(new_df1,POST.3)), digits=2)` (`r q1q3(pull(new_df1,POST.3))`) | `r round(median(pull(new_df2,PRE.3)), digits = 2)` (`r q1q3(pull(new_df2,PRE.3))`) | `r round(median(pull(new_df2,POST.3)), digits=2)` (`r q1q3(pull(new_df2,POST.3))`)
LDL Cholesterol (mg/dL) | `r round(mean(pull(new_df1,PRE.4)), digits = 2)` +/- `r round(sd(pull(new_df1,PRE.4)), digits = 2)` | `r round(mean(pull(new_df1,POST.4)), digits = 2)` +/- `r round(sd(pull(new_df1,POST.4)), digits = 2)` | `r round(mean(pull(new_df2,PRE.4)), digits = 2)` +/- `r round(sd(pull(new_df2,PRE.4)), digits = 2)` | `r round(mean(pull(new_df2,POST.4)), digits = 2)` +/- `r round(sd(pull(new_df2,POST.4)), digits = 2)`
------ | `r round(median(pull(new_df1,PRE.4)), digits = 2)` (`r q1q3(pull(new_df1,PRE.4))`) | `r round(median(pull(new_df1,POST.4)), digits=2)` (`r q1q3(pull(new_df1,POST.4))`) | `r round(median(pull(new_df2,PRE.4)), digits = 2)` (`r q1q3(pull(new_df2,PRE.4))`) | `r round(median(pull(new_df2,POST.4)), digits=2)` (`r q1q3(pull(new_df2,POST.4))`)
Blood Glucose Level (mmol/L) | `r round(mean(pull(new_df1,PRE.5)), digits = 2)` +/- `r round(sd(pull(new_df1,PRE.5)), digits = 2)` | `r round(mean(pull(new_df1,POST.5)), digits = 2)` +/- `r round(sd(pull(new_df1,POST.5)), digits = 2)` | `r round(mean(pull(new_df2,PRE.5)), digits = 2)` +/- `r round(sd(pull(new_df2,PRE.5)), digits = 2)` | `r round(mean(pull(new_df2,POST.5)), digits = 2)` +/- `r round(sd(pull(new_df2,POST.5)), digits = 2)`
------ | `r round(median(pull(new_df1,PRE.5)), digits = 2)` (`r q1q3(pull(new_df1,PRE.5))`) | `r round(median(pull(new_df1,POST.5)), digits=2)` (`r q1q3(pull(new_df1,POST.5))`) | `r round(median(pull(new_df2,PRE.5)), digits = 2)` (`r q1q3(pull(new_df2,PRE.5))`) | `r round(median(pull(new_df2,POST.5)), digits=2)` (`r q1q3(pull(new_df2,POST.5))`)

# Problem 1b

Two boxplots of intervention groups.

```{r graphics}
library(ggplot2)
```

```{r boxplot BMI, echo = FALSE, eval = FALSE}
group <- factor(pull(exercise, Group), labels = c("Control", "Intervention"))
ggplot(subset(exercise, Group == '1'), aes(y = PRE.2, fill = group)) +
  geom_boxplot() +
  scale_fill_manual(values = c("blue", "red"),
                    labels = expression("Baseline", "6-months")) +
  xlab("Intervention") +
  ylab("Body Mass Index") +
  theme(legend.position = "top", legend.title = element_blank())
```

```{r boxplot LDL, echo = FALSE, eval = FALSE}
ggplot(exercise, select(pull(exercise, subset(PRE.4, Group == '1')), 
                     pull(exercise, subset(POST.4, Group == '1')))) +
  geom_boxplot() +
  scale_fill_manual(values = c("blue", "red"),
                    labels = expression("Baseline", "6-months")) +
  xlab("Intervention") +
  ylab("LDL Cholesterol (mg/dL)") +
  theme(legend.position = "top", legend.title = element_blank())
```

```{r boxplot2 BMI, echo = FALSE, eval = FALSE}
par(mfrow=c(1,2))
with(subset(exercise, Group == '1'), boxplot(PRE.2, xlab = "Baseline",
                                             col = "blue", main = "Intervention"))
with(subset(exercise, Group == '1'), boxplot(POST.2, xlab = "6-months",
                                              col = "red", main = "Intervention"))
```

```{r boxplot3 BMI}
boxplot(PRE.2~Group, data=exercise, col=c("blue","red"))

```

